<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Net::HTTP::Persistent</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Net::HTTP::Persistent</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/lib/bundler/vendor/net/http/persistent_rb.html">
                lib/bundler/vendor/net/http/persistent.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
<a href="Persistent.html">Persistent</a> connections for <a
href="../HTTP.html">Net::HTTP</a>
</p>
<p>
<a href="Persistent.html">Net::HTTP::Persistent</a> maintains persistent
connections across all the servers you wish to talk to. For each host:port
you communicate with a single persistent connection is created.
</p>
<p>
Multiple <a href="Persistent.html">Net::HTTP::Persistent</a> objects will
share the same set of connections.
</p>
<p>
For each thread you <a href="Persistent.html#M000858">start</a> a <a
href="Persistent.html#M000848">new</a> connection will be created. A <a
href="Persistent.html">Net::HTTP::Persistent</a> connection will not be
shared across threads.
</p>
<p>
You can shut down the <a href="../HTTP.html">HTTP</a> connections when done
by calling <a href="Persistent.html#M000878">shutdown</a>. You should name
your <a href="Persistent.html">Net::HTTP::Persistent</a> object if you
intend to call this method.
</p>
<p>
Example:
</p>
<pre>
  require 'net/http/persistent'

  uri = URI 'http://example.com/awesome/web/service'

  http = Net::HTTP::Persistent.new 'my_app_name'

  # perform a GET
  response = http.request uri

  # or

  get = Net::HTTP::Get.new uri.request_uri
  response = http.request get

  # create a POST
  post_uri = uri + 'create'
  post = Net::HTTP::Post.new post_uri.path
  post.set_form_data 'some' =&gt; 'cool data'

  # perform the POST, the URI is always required
  response http.request post_uri, post
</pre>
<p>
Note that for GET, HEAD and other requests that do not have a body you want
to use URI#request_uri not URI#path. The request_uri contains the query
params which are sent in the body for other requests.
</p>
<h2>SSL</h2>
<p>
SSL connections are automatically created depending upon the scheme of the
URI. SSL connections are automatically verified against the default
certificate store for your computer. You can override this by changing
verify_mode or by specifying an alternate cert_store.
</p>
<p>
Here are the SSL settings, see the individual methods for documentation:
</p>
<table>
<tr><td valign="top">certificate        :</td><td>This client&#8216;s certificate

</td></tr>
<tr><td valign="top">ca_file            :</td><td>The certificate-authority

</td></tr>
<tr><td valign="top">cert_store         :</td><td>An SSL certificate store

</td></tr>
<tr><td valign="top">private_key        :</td><td>The client&#8216;s SSL private key

</td></tr>
<tr><td valign="top">reuse_ssl_sessions :</td><td>Reuse a previously opened SSL session for a <a
href="Persistent.html#M000848">new</a> connection

</td></tr>
<tr><td valign="top">ssl_version        :</td><td>Which specific SSL version to use

</td></tr>
<tr><td valign="top">verify_callback    :</td><td>For server certificate verification

</td></tr>
<tr><td valign="top">verify_mode        :</td><td>How connections should be verified

</td></tr>
</table>
<h2>Proxies</h2>
<p>
A proxy can be set through proxy= or at initialization time by providing a
second argument to ::<a href="Persistent.html#M000848">new</a>. The proxy
may be the URI of the proxy server or <tt>:ENV</tt> which will consult
environment variables.
</p>
<p>
See proxy= and <a href="Persistent.html#M000872">proxy_from_env</a> for
details.
</p>
<h2>Headers</h2>
<p>
Headers may be specified for use in every <a
href="Persistent.html#M000877">request</a>. headers are appended to any
headers on the <a href="Persistent.html#M000877">request</a>.
override_headers replace existing headers on the <a
href="Persistent.html#M000877">request</a>.
</p>
<p>
The difference between the two can be seen in setting the User-Agent. Using
<tt>http.headers[&#8216;User-Agent&#8217;] = &#8216;MyUserAgent&#8216;</tt>
will send &quot;Ruby, MyUserAgent&quot; while
<tt>http.override_headers[&#8216;User-Agent&#8217;] =
&#8216;MyUserAgent&#8216;</tt> will send &quot;MyUserAgent&quot;.
</p>
<h2>Tuning</h2>
<h3>Segregation</h3>
<p>
By providing an application name to ::<a
href="Persistent.html#M000848">new</a> you can separate your connections
from the connections of other applications.
</p>
<h3>Idle Timeout</h3>
<p>
If a connection hasn&#8216;t been used for this number of seconds it will
automatically be <a href="Persistent.html#M000876">reset</a> upon the next
use to avoid attempting to send to a closed connection. The default value
is 5 seconds. nil means no timeout. Set through idle_timeout.
</p>
<p>
Reducing this value may help avoid the &quot;too many connection
resets&quot; error when sending non-idempotent requests while increasing
this value will cause fewer round-trips.
</p>
<h3>Read Timeout</h3>
<p>
The amount of time allowed between reading two chunks from the socket. Set
through read_timeout
</p>
<h3>Max Requests</h3>
<p>
The number of requests that should be made before opening a <a
href="Persistent.html#M000848">new</a> connection. Typically many
keep-alive capable servers tune this to 100 or less, so the 101st <a
href="Persistent.html#M000877">request</a> will fail with ECONNRESET. If
unset (default), this value has no effect, if set, connections will be <a
href="Persistent.html#M000876">reset</a> on the <a
href="Persistent.html#M000877">request</a> after max_requests.
</p>
<h3>Open Timeout</h3>
<p>
The amount of time to wait for a connection to be opened. Set through
open_timeout.
</p>
<h3>Socket Options</h3>
<p>
Socket options may be set on newly-created connections. See socket_options
for details.
</p>
<h3>Non-Idempotent Requests</h3>
<p>
By default non-idempotent requests will not be retried per RFC 2616. By
setting retry_change_requests to true requests will automatically be
retried once.
</p>
<p>
Only do this when you know that retrying a POST or other non-idempotent <a
href="Persistent.html#M000877">request</a> is safe for your application and
will not create duplicate resources.
</p>
<p>
The recommended way to handle non-idempotent requests is the following:
</p>
<pre>
  require 'net/http/persistent'

  uri = URI 'http://example.com/awesome/web/service'
  post_uri = uri + 'create'

  http = Net::HTTP::Persistent.new 'my_app_name'

  post = Net::HTTP::Post.new post_uri.path
  # ... fill in POST request

  begin
    response = http.request post_uri, post
  rescue Net::HTTP::Persistent::Error

    # POST failed, make a new request to verify the server did not process
    # the request
    exists_uri = uri + '...'
    response = http.get exists_uri

    # Retry if it failed
    retry if response.code == '404'
  end
</pre>
<p>
The method of determining if the resource was created or not is unique to
the particular service you are using. Of course, you will want to add
protection from infinite looping.
</p>
<h3>Connection Termination</h3>
<p>
If you are done using the <a
href="Persistent.html">Net::HTTP::Persistent</a> instance you may shut down
all the connections in the current thread with <a
href="Persistent.html#M000878">shutdown</a>. This is not recommended for
normal use, it should only be used when it will be several minutes before
you make another <a href="../HTTP.html">HTTP</a> <a
href="Persistent.html#M000877">request</a>.
</p>
<p>
If you are using multiple threads, call <a
href="Persistent.html#M000878">shutdown</a> in each thread when the thread
is done making requests. If you don&#8216;t call <a
href="Persistent.html#M000878">shutdown</a>, that&#8216;s OK. Ruby will
automatically garbage collect and <a
href="Persistent.html#M000878">shutdown</a> your <a
href="../HTTP.html">HTTP</a> connections when the thread terminates.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000851">ca_file=</a>&nbsp;&nbsp;
      <a href="#M000862">can_retry?</a>&nbsp;&nbsp;
      <a href="#M000850">cert=</a>&nbsp;&nbsp;
      <a href="#M000852">cert_store=</a>&nbsp;&nbsp;
      <a href="#M000849">certificate=</a>&nbsp;&nbsp;
      <a href="#M000863">connection_close?</a>&nbsp;&nbsp;
      <a href="#M000865">connection_close?</a>&nbsp;&nbsp;
      <a href="#M000853">connection_for</a>&nbsp;&nbsp;
      <a href="#M000866">connection_keep_alive?</a>&nbsp;&nbsp;
      <a href="#M000864">connection_keep_alive?</a>&nbsp;&nbsp;
      <a href="#M000847">detect_idle_timeout</a>&nbsp;&nbsp;
      <a href="#M000854">error_message</a>&nbsp;&nbsp;
      <a href="#M000855">escape</a>&nbsp;&nbsp;
      <a href="#M000857">expired?</a>&nbsp;&nbsp;
      <a href="#M000859">finish</a>&nbsp;&nbsp;
      <a href="#M000860">http_version</a>&nbsp;&nbsp;
      <a href="#M000861">idempotent?</a>&nbsp;&nbsp;
      <a href="#M000870">key=</a>&nbsp;&nbsp;
      <a href="#M000848">new</a>&nbsp;&nbsp;
      <a href="#M000867">normalize_uri</a>&nbsp;&nbsp;
      <a href="#M000868">pipeline</a>&nbsp;&nbsp;
      <a href="#M000869">private_key=</a>&nbsp;&nbsp;
      <a href="#M000871">proxy=</a>&nbsp;&nbsp;
      <a href="#M000873">proxy_bypass?</a>&nbsp;&nbsp;
      <a href="#M000872">proxy_from_env</a>&nbsp;&nbsp;
      <a href="#M000874">reconnect</a>&nbsp;&nbsp;
      <a href="#M000875">reconnect_ssl</a>&nbsp;&nbsp;
      <a href="#M000877">request</a>&nbsp;&nbsp;
      <a href="#M000876">reset</a>&nbsp;&nbsp;
      <a href="#M000878">shutdown</a>&nbsp;&nbsp;
      <a href="#M000879">shutdown_in_all_threads</a>&nbsp;&nbsp;
      <a href="#M000880">ssl</a>&nbsp;&nbsp;
      <a href="#M000881">ssl_version=</a>&nbsp;&nbsp;
      <a href="#M000858">start</a>&nbsp;&nbsp;
      <a href="#M000856">unescape</a>&nbsp;&nbsp;
      <a href="#M000883">verify_callback=</a>&nbsp;&nbsp;
      <a href="#M000882">verify_mode=</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Class <a href="Persistent/Error.html" class="link">Net::HTTP::Persistent::Error</a><br />

    </div>

    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">HAVE_OPENSSL</td>
          <td>=</td>
          <td class="context-item-value">defined? OpenSSL::SSL # :nodoc:</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Is OpenSSL available? This test works with autoload

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">VERSION</td>
          <td>=</td>
          <td class="context-item-value">'2.9.3'</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
The version of <a href="Persistent.html">Net::HTTP::Persistent</a> you are
using

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">RETRIED_EXCEPTIONS</td>
          <td>=</td>
          <td class="context-item-value">[ # :nodoc:     (Net::ReadTimeout if Net.const_defined? :ReadTimeout),     IOError,     EOFError,     Errno::ECONNRESET,     Errno::ECONNABORTED,     Errno::EPIPE,     (OpenSSL::SSL::SSLError if HAVE_OPENSSL),     Timeout::Error,   ].compact</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Exceptions rescued for automatic retry on ruby 2.0.0. This overlaps with
the exception list for ruby 1.x.

</td>
        </tr>
        </table>
      </div>
    </div>

    <div id="aliases-list">
      <h3 class="section-bar">External Aliases</h3>

      <div class="name-list">
                        <table summary="aliases">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">certificate</td>
          <td>-&gt;</td>
          <td class="context-item-value">cert</td>
        </tr>
      <tr class="top-aligned-row context-row">
        <td>&nbsp;</td>
        <td colspan="2" class="context-item-desc">
For <a href="../HTTP.html">Net::HTTP</a> parity

</td>
      </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">private_key</td>
          <td>-&gt;</td>
          <td class="context-item-value">key</td>
        </tr>
      <tr class="top-aligned-row context-row">
        <td>&nbsp;</td>
        <td colspan="2" class="context-item-desc">
For <a href="../HTTP.html">Net::HTTP</a> parity

</td>
      </tr>
                        </table>
      </div>
    </div>


    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ca_file</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
An SSL certificate authority. Setting this will set verify_mode to
VERIFY_PEER.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">cert_store</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
An SSL certificate store. Setting this will override the default
certificate store. See verify_mode for more information.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">certificate</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
This client&#8216;s OpenSSL::X509::Certificate

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">debug_output</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Sends debug_output to this IO via Net::HTTP#set_debug_output.

<p>
Never use this method in production code, it causes a serious security
hole.
</p>
</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">headers</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
Headers that are added to every <a
href="Persistent.html#M000877">request</a> using Net::HTTP#add_field

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">http_versions</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
Maps host:port to an <a href="../HTTP.html">HTTP</a> version. This allows
us to enable version specific features.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">idle_timeout</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Maximum time an unused connection can remain idle before being
automatically closed.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">keep_alive</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
The value sent in the Keep-Alive header. Defaults to 30. Not needed for <a
href="../HTTP.html">HTTP</a>/1.1 servers.

<p>
This may not work correctly for <a href="../HTTP.html">HTTP</a>/1.0 servers
</p>
<p>
This method may be removed in a future version as RFC 2616 does not require
this header.
</p>
</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">max_requests</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Maximum number of requests on a connection before it is considered expired
and automatically closed.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">name</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
A name for this connection. Allows you to keep your connections apart from
everybody else&#8216;s.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">no_proxy</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
List of host suffixes which will not be proxied

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">open_timeout</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Seconds to wait until a connection is opened. See Net::HTTP#open_timeout

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">override_headers</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
Headers that are added to every <a
href="Persistent.html#M000877">request</a> using <a
href="../HTTP.html">Net::HTTP</a>#[]=

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">private_key</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
This client&#8216;s SSL private key

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">proxy_uri</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The URL through which requests will be proxied

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">read_timeout</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Seconds to wait until reading one block. See Net::HTTP#read_timeout

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">retry_change_requests</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Enable retries of non-idempotent requests that change data (e.g. POST
requests) when the server has disconnected.

<p>
This will in the worst case lead to multiple requests with the same data,
but it may be useful for some applications. Take care when enabling this
option to ensure it is safe to POST or perform other non-idempotent
requests to the server.
</p>
</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">reuse_ssl_sessions</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
By default SSL sessions are reused to avoid extra SSL handshakes. Set this
to false if you have problems communicating with an HTTPS server like:

<pre>
  SSL_connect [...] read finished A: unexpected message (OpenSSL::SSL::SSLError)
</pre>
</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">socket_options</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
An array of options for Socket#setsockopt.

<p>
By default the TCP_NODELAY option is set on sockets.
</p>
<p>
To set additional options append them to this array:
</p>
<pre>
  http.socket_options &lt;&lt; [Socket::SOL_SOCKET, Socket::SO_KEEPALIVE, 1]
</pre>
</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ssl_version</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
SSL version to use.

<p>
By default, the version will be negotiated automatically between client and
server. Ruby 1.9 and newer only.
</p>
</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">verify_callback</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
SSL verification callback. Used when ca_file is set.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">verify_mode</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
HTTPS verify mode. Defaults to OpenSSL::SSL::VERIFY_PEER which verifies the
server certificate.

<p>
If no ca_file or cert_store is set the default system certificate store is
used.
</p>
<p>
You can use <tt>verify_mode</tt> to override any default values.
</p>
</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000847" class="method-detail">
        <a name="M000847"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000847.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000847.html');return false;">
          <span class="method-name">detect_idle_timeout</span><span class="method-args">(uri, max = 10)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Use this method to detect the idle timeout of the host at <tt>uri</tt>. The
value returned can be used to configure idle_timeout. <tt>max</tt> controls
the maximum idle timeout to detect.
</p>
<p>
After
</p>
<p>
Idle timeout detection is performed by creating a connection then
performing a HEAD <a href="Persistent.html#M000877">request</a> in a loop
until the connection terminates waiting one additional second per loop.
</p>
<p>
NOTE: This may not work on ruby &gt; 1.9.
</p>
        </div>
      </div>

      <div id="method-M000848" class="method-detail">
        <a name="M000848"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000848.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000848.html');return false;">
          <span class="method-name">new</span><span class="method-args">(name = nil, proxy = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a <a href="Persistent.html#M000848">new</a> <a
href="Persistent.html">Net::HTTP::Persistent</a>.
</p>
<p>
Set <tt>name</tt> to keep your connections apart from everybody
else&#8216;s. Not required currently, but highly recommended. Your library
name should be good enough. This parameter will be required in a future
version.
</p>
<p>
<tt>proxy</tt> may be set to a URI::HTTP or :ENV to pick up proxy options
from the environment. See <a
href="Persistent.html#M000872">proxy_from_env</a> for details.
</p>
<p>
In order to use a URI for the proxy you may need to do some extra work
beyond URI parsing if the proxy requires a password:
</p>
<pre>
  proxy = URI 'http://proxy.example'
  proxy.user     = 'AzureDiamond'
  proxy.password = 'hunter2'
</pre>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000851" class="method-detail">
        <a name="M000851"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000851.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000851.html');return false;">
          <span class="method-name">ca_file=</span><span class="method-args">(file)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets the SSL certificate authority file.
</p>
        </div>
      </div>

      <div id="method-M000862" class="method-detail">
        <a name="M000862"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000862.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000862.html');return false;">
          <span class="method-name">can_retry?</span><span class="method-args">(req, retried_on_ruby_2 = false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Is the <a href="Persistent.html#M000877">request</a> <tt>req</tt>
idempotent or is retry_change_requests allowed.
</p>
<p>
If +retried_on_ruby_2+ is true, true will be returned if we are on ruby,
retry_change_requests is allowed and the <a
href="Persistent.html#M000877">request</a> is not idempotent.
</p>
        </div>
      </div>

      <div id="method-M000850" class="method-detail">
        <a name="M000850"></a>

        <div class="method-heading">
          <span class="method-name">cert=</span><span class="method-args">(certificate)</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for certificate=
</p>
        </div>
      </div>

      <div id="method-M000852" class="method-detail">
        <a name="M000852"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000852.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000852.html');return false;">
          <span class="method-name">cert_store=</span><span class="method-args">(store)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Overrides the default SSL certificate store used for verifying connections.
</p>
        </div>
      </div>

      <div id="method-M000849" class="method-detail">
        <a name="M000849"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000849.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000849.html');return false;">
          <span class="method-name">certificate=</span><span class="method-args">(certificate)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets this client&#8216;s OpenSSL::X509::Certificate
</p>
        </div>
      </div>

      <div id="method-M000863" class="method-detail">
        <a name="M000863"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000863.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000863.html');return false;">
          <span class="method-name">connection_close?</span><span class="method-args">(header)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Workaround for missing Net::HTTPHeader#connection_close? on Ruby 1.8
</p>
        </div>
      </div>

      <div id="method-M000865" class="method-detail">
        <a name="M000865"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000865.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000865.html');return false;">
          <span class="method-name">connection_close?</span><span class="method-args">(header)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Workaround for missing Net::HTTPRequest#connection_close? on Ruby 1.8
</p>
        </div>
      </div>

      <div id="method-M000853" class="method-detail">
        <a name="M000853"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000853.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000853.html');return false;">
          <span class="method-name">connection_for</span><span class="method-args">(uri)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a <a href="Persistent.html#M000848">new</a> connection for
<tt>uri</tt>
</p>
        </div>
      </div>

      <div id="method-M000866" class="method-detail">
        <a name="M000866"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000866.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000866.html');return false;">
          <span class="method-name">connection_keep_alive?</span><span class="method-args">(header)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Workaround for missing Net::HTTPRequest#connection_keep_alive? on Ruby 1.8
</p>
        </div>
      </div>

      <div id="method-M000864" class="method-detail">
        <a name="M000864"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000864.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000864.html');return false;">
          <span class="method-name">connection_keep_alive?</span><span class="method-args">(header)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Workaround for missing Net::HTTPHeader#connection_keep_alive? on Ruby 1.8
</p>
        </div>
      </div>

      <div id="method-M000854" class="method-detail">
        <a name="M000854"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000854.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000854.html');return false;">
          <span class="method-name">error_message</span><span class="method-args">(connection)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an error message containing the number of requests performed on
this connection
</p>
        </div>
      </div>

      <div id="method-M000855" class="method-detail">
        <a name="M000855"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000855.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000855.html');return false;">
          <span class="method-name">escape</span><span class="method-args">(str)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
URI::escape wrapper
</p>
        </div>
      </div>

      <div id="method-M000857" class="method-detail">
        <a name="M000857"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000857.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000857.html');return false;">
          <span class="method-name">expired?</span><span class="method-args">(connection)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the connection should be <a
href="Persistent.html#M000876">reset</a> due to an idle timeout, or maximum
<a href="Persistent.html#M000877">request</a> count, false otherwise.
</p>
        </div>
      </div>

      <div id="method-M000859" class="method-detail">
        <a name="M000859"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000859.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000859.html');return false;">
          <span class="method-name">finish</span><span class="method-args">(connection, thread = Thread.current)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Finishes the <a href="../HTTP.html">Net::HTTP</a> <tt>connection</tt>
</p>
        </div>
      </div>

      <div id="method-M000860" class="method-detail">
        <a name="M000860"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000860.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000860.html');return false;">
          <span class="method-name">http_version</span><span class="method-args">(uri)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the <a href="../HTTP.html">HTTP</a> protocol version for
<tt>uri</tt>
</p>
        </div>
      </div>

      <div id="method-M000861" class="method-detail">
        <a name="M000861"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000861.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000861.html');return false;">
          <span class="method-name">idempotent?</span><span class="method-args">(req)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Is <tt>req</tt> idempotent according to RFC 2616?
</p>
        </div>
      </div>

      <div id="method-M000870" class="method-detail">
        <a name="M000870"></a>

        <div class="method-heading">
          <span class="method-name">key=</span><span class="method-args">(key)</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for private_key=
</p>
        </div>
      </div>

      <div id="method-M000867" class="method-detail">
        <a name="M000867"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000867.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000867.html');return false;">
          <span class="method-name">normalize_uri</span><span class="method-args">(uri)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds &quot;http://&quot; to the String <tt>uri</tt> if it is missing.
</p>
        </div>
      </div>

      <div id="method-M000868" class="method-detail">
        <a name="M000868"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000868.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000868.html');return false;">
          <span class="method-name">pipeline</span><span class="method-args">(uri, requests {|responses| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Pipelines <tt>requests</tt> to the <a href="../HTTP.html">HTTP</a> server
at <tt>uri</tt> yielding responses if a block is given. Returns all
responses recieved.
</p>
<p>
See <a
href="http://docs.seattlerb.org/net-http-pipeline/Net/HTTP/Pipeline.html">Net::HTTP::Pipeline</a>
for further details.
</p>
<p>
Only if <tt>net-http-<a href="Persistent.html#M000868">pipeline</a></tt>
was required before <tt>net-http-persistent</tt> <a
href="Persistent.html#M000868">pipeline</a> will be present.
</p>
        </div>
      </div>

      <div id="method-M000869" class="method-detail">
        <a name="M000869"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000869.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000869.html');return false;">
          <span class="method-name">private_key=</span><span class="method-args">(key)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets this client&#8216;s SSL private key
</p>
        </div>
      </div>

      <div id="method-M000871" class="method-detail">
        <a name="M000871"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000871.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000871.html');return false;">
          <span class="method-name">proxy=</span><span class="method-args">(proxy)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets the proxy server. The <tt>proxy</tt> may be the URI of the proxy
server, the symbol +:ENV+ which will read the proxy from the environment or
nil to disable use of a proxy. See <a
href="Persistent.html#M000872">proxy_from_env</a> for details on setting
the proxy from the environment.
</p>
<p>
If the proxy URI is set after requests have been made, the next <a
href="Persistent.html#M000877">request</a> will shut-down and re-open all
connections.
</p>
<p>
The <tt>no_proxy</tt> query parameter can be used to specify hosts which
shouldn&#8216;t be reached via proxy; if set it should be a comma separated
list of hostname suffixes, optionally with +:port+ appended, for example
<tt>example.com,some.host:8080</tt>.
</p>
        </div>
      </div>

      <div id="method-M000873" class="method-detail">
        <a name="M000873"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000873.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000873.html');return false;">
          <span class="method-name">proxy_bypass?</span><span class="method-args">(host, port)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true when proxy should by bypassed for host.
</p>
        </div>
      </div>

      <div id="method-M000872" class="method-detail">
        <a name="M000872"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000872.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000872.html');return false;">
          <span class="method-name">proxy_from_env</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a URI for an <a href="../HTTP.html">HTTP</a> proxy server from ENV
variables.
</p>
<p>
If <tt>HTTP_PROXY</tt> is set a proxy will be returned.
</p>
<p>
If <tt>HTTP_PROXY_USER</tt> or <tt>HTTP_PROXY_PASS</tt> are set the URI is
given the indicated user and password unless HTTP_PROXY contains either of
these in the URI.
</p>
<p>
The <tt>NO_PROXY</tt> ENV variable can be used to specify hosts which
shouldn&#8216;t be reached via proxy; if set it should be a comma separated
list of hostname suffixes, optionally with +:port+ appended, for example
<tt>example.com,some.host:8080</tt>. When set to <tt>*</tt> no proxy will
be returned.
</p>
<p>
For Windows users, lowercase ENV variables are preferred over uppercase ENV
variables.
</p>
        </div>
      </div>

      <div id="method-M000874" class="method-detail">
        <a name="M000874"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000874.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000874.html');return false;">
          <span class="method-name">reconnect</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Forces reconnection of <a href="../HTTP.html">HTTP</a> connections.
</p>
        </div>
      </div>

      <div id="method-M000875" class="method-detail">
        <a name="M000875"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000875.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000875.html');return false;">
          <span class="method-name">reconnect_ssl</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Forces reconnection of SSL connections.
</p>
        </div>
      </div>

      <div id="method-M000877" class="method-detail">
        <a name="M000877"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000877.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000877.html');return false;">
          <span class="method-name">request</span><span class="method-args">(uri, req = nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Makes a <a href="Persistent.html#M000877">request</a> on <tt>uri</tt>. If
<tt>req</tt> is nil a Net::HTTP::Get is performed against <tt>uri</tt>.
</p>
<p>
If a block is passed <a href="Persistent.html#M000877">request</a> behaves
like Net::HTTP#request (the body of the response will not have been read).
</p>
<p>
<tt>req</tt> must be a Net::HTTPRequest subclass (see <a
href="../HTTP.html">Net::HTTP</a> for a list).
</p>
<p>
If there is an error and the <a href="Persistent.html#M000877">request</a>
is idempotent according to RFC 2616 it will be retried automatically.
</p>
        </div>
      </div>

      <div id="method-M000876" class="method-detail">
        <a name="M000876"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000876.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000876.html');return false;">
          <span class="method-name">reset</span><span class="method-args">(connection)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Finishes then restarts the <a href="../HTTP.html">Net::HTTP</a>
<tt>connection</tt>
</p>
        </div>
      </div>

      <div id="method-M000878" class="method-detail">
        <a name="M000878"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000878.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000878.html');return false;">
          <span class="method-name">shutdown</span><span class="method-args">(thread = Thread.current)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Shuts down all connections for <tt>thread</tt>.
</p>
<p>
Uses the current thread by default.
</p>
<p>
If you&#8216;ve used <a href="Persistent.html">Net::HTTP::Persistent</a>
across multiple threads you should call this in each thread when
you&#8216;re done making <a href="../HTTP.html">HTTP</a> requests.
</p>
<p>
<b>NOTE</b>: Calling <a href="Persistent.html#M000878">shutdown</a> for
another thread can be dangerous!
</p>
<p>
If the thread is still using the connection it may cause an error! It is
best to call <a href="Persistent.html#M000878">shutdown</a> in the thread
at the appropriate time instead!
</p>
        </div>
      </div>

      <div id="method-M000879" class="method-detail">
        <a name="M000879"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000879.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000879.html');return false;">
          <span class="method-name">shutdown_in_all_threads</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Shuts down all connections in all threads
</p>
<p>
<b>NOTE</b>: THIS METHOD IS VERY DANGEROUS!
</p>
<p>
Do not call this method if other threads are still using their connections!
Call <a href="Persistent.html#M000878">shutdown</a> at the appropriate time
instead!
</p>
<p>
Use this method only as a last resort!
</p>
        </div>
      </div>

      <div id="method-M000880" class="method-detail">
        <a name="M000880"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000880.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000880.html');return false;">
          <span class="method-name">ssl</span><span class="method-args">(connection)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Enables SSL on <tt>connection</tt>
</p>
        </div>
      </div>

      <div id="method-M000881" class="method-detail">
        <a name="M000881"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000881.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000881.html');return false;">
          <span class="method-name">ssl_version=</span><span class="method-args">(ssl_version)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
SSL version to use
</p>
        </div>
      </div>

      <div id="method-M000858" class="method-detail">
        <a name="M000858"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000858.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000858.html');return false;">
          <span class="method-name">start</span><span class="method-args">(connection)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Starts the <a href="../HTTP.html">Net::HTTP</a> <tt>connection</tt>
</p>
        </div>
      </div>

      <div id="method-M000856" class="method-detail">
        <a name="M000856"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000856.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000856.html');return false;">
          <span class="method-name">unescape</span><span class="method-args">(str)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
URI::unescape wrapper
</p>
        </div>
      </div>

      <div id="method-M000883" class="method-detail">
        <a name="M000883"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000883.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000883.html');return false;">
          <span class="method-name">verify_callback=</span><span class="method-args">(callback)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
SSL verification callback.
</p>
        </div>
      </div>

      <div id="method-M000882" class="method-detail">
        <a name="M000882"></a>

        <div class="method-heading">
          <a href="Persistent.src/M000882.html" target="Code" class="method-signature"
            onclick="popupCode('Persistent.src/M000882.html');return false;">
          <span class="method-name">verify_mode=</span><span class="method-args">(verify_mode)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets the HTTPS verify mode. Defaults to OpenSSL::SSL::VERIFY_PEER.
</p>
<p>
Setting this to VERIFY_NONE is a VERY BAD IDEA and should NEVER be used.
Securely transfer the correct certificate and update the default
certificate store or set the ca file instead.
</p>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>